<div class="page">
  <header class="page-header">
    <h1>Settings</h1>
    <p class="subtitle">Configure your addon manager</p>
  </header>

  <div class="settings-sections">
    <!-- WoW Installations -->
    <div class="section">
      <button class="section-header" (click)="toggleSection('installations')">
        <span class="section-title">WoW Installations</span>
        <span class="expand-icon">{{ isSectionExpanded('installations') ? '▼' : '▶' }}</span>
      </button>

      @if (isSectionExpanded('installations')) {
      <div class="section-content">
        <p class="section-description">
          Manage your World of Warcraft installations.
        </p>

        <div class="installations-list">
          @for (install of addonService.installations$(); track install.id) {
          <div class="installation-card" [class.active]="install.id === addonService.activeInstallationId$()">
            <div class="install-info">
              <div class="install-header">
                <strong>{{ install.name }}</strong>
                <span class="version-badge">v{{ install.version }}</span>
                @if (install.id === addonService.activeInstallationId$()) {
                <span class="active-badge">Active</span>
                }
              </div>
              <div class="install-path">{{ install.directory }}</div>
            </div>
            <div class="install-actions">
              @if (install.id !== addonService.activeInstallationId$()) {
              <button class="secondary-button small" (click)="setActive(install.id)">Set Active</button>
              }
              <button class="secondary-button small" (click)="editDirectory(install.id)">Change Path</button>
              <button class="danger-button small" (click)="removeInstallation(install.id)">Remove</button>
            </div>
          </div>
          }

          @if (addonService.installations$().length === 0) {
          <div class="empty-state">
            No installations found. Add one to get started.
          </div>
          }
        </div>

        <button class="primary-button full-width" (click)="showAddInstallationDialog()">
          + Add WoW Installation
        </button>
      </div>
      }
    </div>

    <!-- Import/Export -->
    <div class="section">
      <button class="section-header" (click)="toggleSection('import-export')">
        <span class="section-title">Import / Export</span>
        <span class="expand-icon">{{ isSectionExpanded('import-export') ? '▼' : '▶' }}</span>
      </button>

      @if (isSectionExpanded('import-export')) {
      <div class="section-content">
        <p class="section-description">
          Backup your addon list or import from another installation.
        </p>

        <div class="import-export-buttons">
          <button class="secondary-button" (click)="exportAddons()">
            Export Addon List
          </button>
          <label class="secondary-button file-input-label">
            Import Addon List
            <input type="file" accept=".json" (change)="importAddons($event)" class="file-input" />
          </label>
        </div>

        <div class="info-box">
          <strong>Note:</strong> Export creates a JSON file with your addon list.
          Importing will merge addons with your current installation.
        </div>
      </div>
      }
    </div>

    <!-- App Configuration -->
    <div class="section">
      <button class="section-header" (click)="toggleSection('config')">
        <span class="section-title">App Configuration</span>
        <span class="expand-icon">{{ isSectionExpanded('config') ? '▼' : '▶' }}</span>
      </button>

      @if (isSectionExpanded('config')) {
      <div class="section-content">
        <div class="config-options">
          <div class="config-item">
            <div class="config-info">
              <label class="label">Auto-Update Check</label>
              <p class="description">Automatically check for addon updates on startup</p>
            </div>
            <label class="toggle">
              <input type="checkbox" [checked]="autoUpdate()" (change)="autoUpdate.set(!autoUpdate())" />
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="config-item">
            <div class="config-info">
              <label class="label">Show Beta Versions</label>
              <p class="description">Include pre-release versions in updates</p>
            </div>
            <label class="toggle">
              <input type="checkbox" [checked]="showBetaVersions()"
                (change)="showBetaVersions.set(!showBetaVersions())" />
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="config-item">
            <div class="config-info">
              <label class="label">Theme</label>
              <p class="description">Choose your preferred color scheme</p>
            </div>
            <select class="select-input" [value]="theme()" (change)="theme.set($any($event.target).value)">
              <option value="dark">Dark</option>
              <option value="light">Light (Coming Soon)</option>
            </select>
          </div>
        </div>
      </div>
      }
    </div>

    <!-- About -->
    <div class="section">
      <button class="section-header" (click)="toggleSection('about')">
        <span class="section-title">About</span>
        <span class="expand-icon">{{ isSectionExpanded('about') ? '▼' : '▶' }}</span>
      </button>

      @if (isSectionExpanded('about')) {
      <div class="section-content">
        <div class="about-info">
          <h3>Zen Addons Manager</h3>
          <p class="version">Version 1.0.0</p>
          <p class="copyright">© 2024 Zen Addons Manager</p>
          <p class="description-text">
            A clean, minimal addon manager for World of Warcraft.
            Built with Angular and Electron.
          </p>
        </div>
      </div>
      }
    </div>
  </div>
</div>

<!-- Add Installation Dialog -->
@if (showAddDialog()) {
<div class="dialog-overlay">
  <div class="dialog">
    <div class="dialog-header">
      <h3>Add WoW Installation</h3>
      <button class="close-button" (click)="showAddDialog.set(false)">×</button>
    </div>

    <div class="dialog-content">
      <div class="form-group">
        <label>WoW Version</label>
        <select [(ngModel)]="selectedVersion" class="select-input">
          <option value="" disabled selected>Select Version...</option>
          <option value="Vanilla|1.12">Vanilla (1.12)</option>
          <option value="Burning Crusade|2.4.3">Burning Crusade (2.4.3)</option>
          <option value="Wrath of the Lich King|3.3.5">Wrath of the Lich King (3.3.5)</option>
          <option value="Cataclysm|4.3.4">Cataclysm (4.3.4)</option>
          <option value="Pandaria|5.4.8">Pandaria (5.4.8)</option>
        </select>
      </div>

      <div class="form-group">
        <label>Addons Directory</label>
        <div class="input-group">
          <input type="text" [(ngModel)]="customDirectory" placeholder="Path to Interface/AddOns" class="text-input"
            readonly />
          <button class="secondary-button" (click)="browseDirectory()">Browse...</button>
        </div>
      </div>
    </div>

    <div class="dialog-actions">
      <button class="secondary-button" (click)="showAddDialog.set(false)">Cancel</button>
      <button class="primary-button" (click)="addInstallation()" [disabled]="!selectedVersion() || !customDirectory()">
        Add Installation
      </button>
    </div>
  </div>
</div>
}
